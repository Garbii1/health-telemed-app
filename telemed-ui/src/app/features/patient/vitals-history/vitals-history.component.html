<!-- src/app/features/patient/vitals-history/vitals-history.component.html -->
<div class="vitals-history-container mt-2">

  <!-- ===== No Data State ===== -->
  <!-- Show this message if the input array is empty or null -->
  <div *ngIf="!vitalsData || vitalsData.length === 0" class="alert alert-light text-center border-0 no-data-placeholder py-4 my-3">
    <i class="fas fa-file-medical-alt fa-2x mb-2 text-muted"></i>
    <p class="mb-0">No vital records found.</p>
    <!-- You might want to link back to the "Add Vital" area if the form isn't always visible -->
    <!-- <p class="mt-2 small"><a routerLink="../vitals">Add your first record?</a></p> -->
  </div>

  <!-- ===== Data Available State ===== -->
  <!-- Show charts and table *only* if vitalsData array has items -->
  <ng-container *ngIf="vitalsData && vitalsData.length > 0">

    <!-- --- Charts Section --- -->
    <!-- Only render the charts section if there's chart data processed -->
    <div class="charts-section row mb-4" *ngIf="bpChartData.length > 0 || hrChartData.length > 0 || glucoseChartData.length > 0 || tempChartData.length > 0">
      <h5 class="mb-3 chart-section-title">Vital Trends</h5> <!-- Optional title for chart section -->

      <!-- Blood Pressure Chart -->
      <div class="col-lg-6 mb-4 chart-card-wrapper" *ngIf="bpChartData.length > 0">
        <div class="card shadow-sm h-100">
          <div class="card-header bg-light border-0">Blood Pressure (mmHg)</div>
          <div class="card-body text-center"> <!-- Center chart horizontally -->
            <ngx-charts-line-chart
              [view]="view"
              [scheme]="colorSchemeBP"
              [legend]="legend"
              [showXAxisLabel]="showXAxisLabel"
              [showYAxisLabel]="showYAxisLabel"
              [xAxis]="xAxis"
              [yAxis]="yAxis"
              [xAxisLabel]="xAxisLabel"
              yAxisLabel="Pressure (mmHg)"
              [timeline]="timeline"
              [results]="bpChartData"
              [autoScale]="true"
              [roundDomains]="true">
            </ngx-charts-line-chart>
          </div>
        </div>
      </div>

      <!-- Heart Rate Chart -->
       <div class="col-lg-6 mb-4 chart-card-wrapper" *ngIf="hrChartData.length > 0">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-light border-0">Heart Rate (bpm)</div>
            <div class="card-body text-center">
               <ngx-charts-line-chart
                 [view]="view"
                 [scheme]="colorSchemeHR"
                 [legend]="legend"
                 [showXAxisLabel]="showXAxisLabel"
                 [showYAxisLabel]="showYAxisLabel"
                 [xAxis]="xAxis"
                 [yAxis]="yAxis"
                 [xAxisLabel]="xAxisLabel"
                 yAxisLabel="Heart Rate (bpm)"
                 [timeline]="timeline"
                 [results]="hrChartData"
                 [autoScale]="true"
                 [roundDomains]="true">
               </ngx-charts-line-chart>
            </div>
          </div>
       </div>

      <!-- Glucose Chart -->
       <div class="col-lg-6 mb-4 chart-card-wrapper" *ngIf="glucoseChartData.length > 0">
          <div class="card shadow-sm h-100">
             <div class="card-header bg-light border-0">Glucose (mg/dL)</div>
             <div class="card-body text-center">
               <ngx-charts-line-chart
                 [view]="view"
                 [scheme]="colorSchemeGlucose"
                 [legend]="legend"
                 [showXAxisLabel]="showXAxisLabel"
                 [showYAxisLabel]="showYAxisLabel"
                 [xAxis]="xAxis"
                 [yAxis]="yAxis"
                 [xAxisLabel]="xAxisLabel"
                 yAxisLabel="Glucose (mg/dL)"
                 [timeline]="timeline"
                 [results]="glucoseChartData"
                 [autoScale]="true"
                 [roundDomains]="true">
               </ngx-charts-line-chart>
             </div>
          </div>
       </div>

       <!-- Temperature Chart -->
        <div class="col-lg-6 mb-4 chart-card-wrapper" *ngIf="tempChartData.length > 0">
           <div class="card shadow-sm h-100">
              <div class="card-header bg-light border-0">Temperature (°C)</div>
              <div class="card-body text-center">
                <ngx-charts-line-chart
                  [view]="view"
                  [scheme]="colorSchemeTemp"
                  [legend]="legend"
                  [showXAxisLabel]="showXAxisLabel"
                  [showYAxisLabel]="showYAxisLabel"
                  [xAxis]="xAxis"
                  [yAxis]="yAxis"
                  [xAxisLabel]="xAxisLabel"
                  yAxisLabel="Temperature (°C)"
                  [timeline]="timeline"
                  [results]="tempChartData"
                  [autoScale]="true"
                  [roundDomains]="true">
                </ngx-charts-line-chart>
              </div>
           </div>
        </div>

    </div> <!-- End Charts Section -->

    <!-- --- History Table Section --- -->
    <div class="history-table-section mt-4">
      <h5 class="mb-3">Detailed History</h5>
      <div class="table-responsive shadow-sm rounded"> <!-- Add shadow/border -->
        <table class="table table-striped table-hover table-bordered mb-0"> <!-- Added bordered, removed mb -->
          <thead class="table-light"> <!-- Light header -->
            <tr>
              <th>Date & Time</th>
              <th>BP (Sys/Dia)</th>
              <th>Heart Rate (bpm)</th>
              <th>Glucose (mg/dL)</th>
              <th>Temp (°C)</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <!-- Iterate over original input data for table (maintains original sort order) -->
            <tr *ngFor="let record of vitalsData">
              <td class="text-nowrap">{{ formatDate(record.record_time) }}</td>
              <td class="text-nowrap">{{ record.blood_pressure_systolic ?? '-' }} / {{ record.blood_pressure_diastolic ?? '-' }}</td>
              <td class="text-center">{{ record.heart_rate ?? 'N/A' }}</td>
              <td class="text-center">{{ record.glucose_level ?? 'N/A' }}</td>
              <td class="text-center">{{ record.temperature ?? 'N/A' }}</td>
              <td class="notes-cell">{{ record.notes || '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div> <!-- End History Table Section -->

  </ng-container> <!-- End *ngIf vitalsData has items -->

</div> <!-- End .vitals-history-container -->

<!-- Component-specific styles -->
<style>
  .no-data-placeholder { background-color: transparent !important; }
  .chart-section-title { font-weight: 500; color: var(--text-color); }
  .chart-card-wrapper .card { border: none; }
  .chart-card-wrapper .card-header { font-size: 0.9rem; font-weight: 500; color: var(--text-color-light); }
  .chart-card-wrapper .card-body { padding: 0.5rem; /* Less padding around chart */ overflow: hidden; /* Prevent chart overflow */ }
  /* Ensure charts are responsive */
  ngx-charts-line-chart { display: block; width: 100% !important; height: auto !important;}

  .history-table-section h5 { font-weight: 500; }
  .table th { font-weight: 500; font-size: 0.85rem; white-space: nowrap;}
  .table td { font-size: 0.9rem; vertical-align: middle; }
  .notes-cell { white-space: pre-wrap; /* Allow notes to wrap */ word-break: break-word; min-width: 150px; }
  .text-nowrap { white-space: nowrap; }
  .table-bordered { border: 1px solid var(--border-color); }
  .table-bordered th, .table-bordered td { border: 1px solid var(--border-color); }
  .table > :not(caption) > * > * { padding: 0.6rem 0.6rem; } /* Adjust cell padding */
</style>