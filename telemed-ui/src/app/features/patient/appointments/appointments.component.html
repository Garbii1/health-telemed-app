<!-- src/app/features/patient/appointments/appointments.component.html -->
<div class="container patient-appointments-container py-4">

  <!-- Page Header -->
  <div class="page-header d-flex justify-content-between align-items-center mb-3 flex-wrap border-bottom pb-3">
    <div>
      <h2 class="dashboard-title mb-1">My Appointments</h2>
      <p class="text-muted mb-0">View your past and upcoming virtual consultations.</p>
    </div>
    <div class="filter-options mt-2 mt-md-0 d-flex align-items-center">
      <label for="statusFilter" class="form-label me-2 mb-0 small text-muted">Filter by Status:</label>
      <!-- Use ngModel for two-way binding OR keep (change) event -->
      <select id="statusFilter" class="form-select form-select-sm" (change)="onFilterChange($event)" [value]="filterStatus.value" style="width: auto;">
         <option value="ALL">All</option>
         <option value="SCHEDULED">Scheduled</option>
         <option value="COMPLETED">Completed</option>
         <option value="CANCELLED">Cancelled</option>
      </select>
    </div>
  </div>

  <!-- Book New Button -->
   <div class="mb-4 text-end">
    <a routerLink="../book-appointment" class="btn btn-primary"> <i class="fas fa-plus me-1"></i> Book New Appointment </a>
   </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center mt-4 pt-5">
    <app-loading-spinner [isLoading]="true" message="Loading appointments..."></app-loading-spinner>
  </div>

  <!-- Error States -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger mt-3"> {{ errorMessage }} <button class="btn btn-sm btn-outline-secondary ms-3" (click)="loadAppointments()">Retry</button> </div>
  <div *ngIf="cancelError" class="alert alert-danger mt-3"> {{ cancelError }} </div>

  <!-- Appointments List/Cards -->
  <!-- Bind directly to the 'appointments' property, check !isLoading -->
  <div *ngIf="!isLoading && !errorMessage">
    <!-- Check if the appointments array (not the observable) is empty -->
    <div *ngIf="!appointments || appointments.length === 0" class="alert alert-light text-center border-0 no-data-placeholder py-5 my-3">
       <i class="fas fa-calendar-times fa-2x mb-2 text-muted"></i>
       <p class="mb-0">No appointments found matching the selected filter.</p>
    </div>

    <!-- Show list only if the appointments array has items -->
    <div class="appointment-list" *ngIf="appointments && appointments.length > 0">
      <!-- Loop over the component's appointments property -->
      <div *ngFor="let appt of appointments" class="card appointment-card shadow-sm mb-3">
        <!-- ... Card structure remains the same as before ... -->
         <div class="card-body p-3">
           <div class="row align-items-center">
               <div class="col-md-8 col-lg-9"> <!-- Details --> </div>
               <div class="col-md-4 col-lg-3 text-md-end mt-2 mt-md-0 d-flex flex-column align-items-md-end"> <!-- Status/Actions --> </div>
           </div>
           <div *ngIf="appt.status === 'COMPLETED' && appt.consultation_notes" class="notes-section mt-3 pt-3 border-top"> <!-- Notes --> </div>
        </div>
      </div>
    </div>
  </div>

</div> <!-- /container -->